<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ö–æ–Ω—Ç—Ä–æ–ª—å –ü–æ—Å—Ç–∞–≤–æ–∫</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body { background-color: var(--tg-theme-bg-color, #f5f5f5); color: var(--tg-theme-text-color, #000); }
        .card { background-color: var(--tg-theme-secondary-bg-color, #fff); }
    </style>
</head>
<body class="p-4 pb-20">

    <h1 class="text-xl font-bold mb-4">üì¶ –ü–æ—Å—Ç–∞–≤–∫–∏ (Vercel)</h1>

    <div class="mb-6">
        <label class="text-xs text-gray-500 mb-1 block">–í—Å—Ç–∞–≤—å—Ç–µ —Å–ø–∏—Å–æ–∫ (—á–µ—Ä–µ–∑ Enter –∏–ª–∏ –∑–∞–ø—è—Ç—É—é)</label>
        <textarea id="bulkInput" rows="3" placeholder="–ü—Ä–∏–º–µ—Ä:&#10;–ú–æ–ª–æ–∫–æ 10–ª&#10;–ö–æ—Ñ–µ 1–∫–≥&#10;–°—Ç–∞–∫–∞–Ω—ã" 
                  class="w-full p-3 border rounded-lg text-black shadow-sm focus:ring-2 focus:ring-blue-500 outline-none"></textarea>
        <button onclick="parseAndAdd()" class="mt-2 w-full bg-blue-600 text-white py-3 rounded-lg font-bold shadow hover:bg-blue-700 transition">
            ‚ûï –†–∞–∑–æ–±—Ä–∞—Ç—å –∏ –¥–æ–±–∞–≤–∏—Ç—å
        </button>
    </div>

    <div class="flex gap-2 mb-4 overflow-x-auto pb-2">
        <button onclick="filterShow('all')" class="px-4 py-1 bg-gray-200 rounded-full text-sm font-medium hover:bg-gray-300">–í—Å–µ</button>
        <button onclick="filterShow('new')" class="px-4 py-1 bg-red-100 text-red-700 rounded-full text-sm font-medium">–ù–æ–≤—ã–µ</button>
        <button onclick="filterShow('ordered')" class="px-4 py-1 bg-yellow-100 text-yellow-700 rounded-full text-sm font-medium">–í –ø—É—Ç–∏</button>
    </div>

    <div id="ordersList" class="space-y-3"></div>

    <script>
        const tg = window.Telegram.WebApp;
        tg.expand();

        // --- –ë–ê–ó–ê –î–ê–ù–ù–´–• (–í –ø–∞–º—è—Ç–∏ —Ç–µ–ª–µ—Ñ–æ–Ω–∞) ---
        let orders = JSON.parse(localStorage.getItem('supply_orders')) || [];

        function saveOrders() {
            localStorage.setItem('supply_orders', JSON.stringify(orders));
            renderOrders();
        }

        // --- –ü–ê–†–°–ï–† (–ì–õ–ê–í–ù–ê–Ø –§–ò–®–ö–ê) ---
        function parseAndAdd() {
            const text = document.getElementById('bulkInput').value;
            if (!text.trim()) return;

            // –ú–∞–≥–∏—è: —Ä–∞–∑–±–∏–≤–∞–µ–º —Ç–µ–∫—Å—Ç –ø–æ –ø–µ—Ä–µ–Ω–æ—Å—É —Å—Ç—Ä–æ–∫–∏ (\n) –ò–õ–ò –ø–æ –∑–∞–ø—è—Ç—ã–º (,)
            const lines = text.split(/[\n,]+/);

            lines.forEach(line => {
                const cleanItem = line.trim();
                if (cleanItem.length > 1) { // –ò–≥–Ω–æ—Ä–∏—Ä—É–µ–º –ø—É—Å—Ç—ã–µ –∫—É—Å–∫–∏
                    orders.unshift({
                        id: Date.now() + Math.random(), // –£–Ω–∏–∫–∞–ª—å–Ω—ã–π ID
                        text: cleanItem,
                        status: 'new', // new -> ordered -> received
                        date: new Date().toLocaleTimeString()
                    });
                }
            });

            document.getElementById('bulkInput').value = ''; // –û—á–∏—Å—Ç–∏—Ç—å –ø–æ–ª–µ
            saveOrders();
            tg.HapticFeedback.notificationOccurred('success'); // –í–∏–±—Ä–∞—Ü–∏—è –≤ —Ç–µ–ª–µ—Ñ–æ–Ω–µ
        }

        // --- –õ–û–ì–ò–ö–ê –°–¢–ê–¢–£–°–û–í ---
        function updateStatus(id) {
            const order = orders.find(o => o.id === id);
            if (!order) return;

            if (order.status === 'new') {
                order.status = 'ordered';
            } else if (order.status === 'ordered') {
                if (confirm('–¢–æ–≤–∞—Ä ' + order.text + ' –ø—Ä–∏–µ—Ö–∞–ª? –£–±–∏—Ä–∞–µ–º –∏–∑ —Å–ø–∏—Å–∫–∞?')) {
                    orders = orders.filter(o => o.id !== id); // –£–¥–∞–ª—è–µ–º
                }
            }
            saveOrders();
        }

        // --- –û–¢–†–ò–°–û–í–ö–ê ---
        function renderOrders(filter = 'all') {
            const container = document.getElementById('ordersList');
            container.innerHTML = '';

            if (orders.length === 0) {
                container.innerHTML = '<div class="text-center text-gray-400 mt-10">–°–ø–∏—Å–æ–∫ –ø—É—Å—Ç ‚ú®</div>';
                return;
            }

            orders.forEach(order => {
                // –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è (–µ—Å–ª–∏ –Ω—É–∂–Ω–æ)
                if (filter !== 'all' && order.status !== filter) return;

                let statusClass = order.status === 'new' ? 'border-l-4 border-red-500' : 'border-l-4 border-yellow-400 bg-yellow-50';
                let btnText = order.status === 'new' ? '–í –∑–∞–∫–∞–∑ ‚û°Ô∏è' : '–ü—Ä–∏–Ω—è—Ç—å ‚úÖ';
                let btnClass = order.status === 'new' ? 'bg-blue-600' : 'bg-green-600';
                let label = order.status === 'new' ? 'üî¥ –°–†–û–ß–ù–û' : 'üöö –ï–î–ï–¢';

                const html = `
                <div class="card p-4 rounded-lg shadow-sm flex justify-between items-center ${statusClass} transition-all">
                    <div class="w-2/3">
                        <div class="text-[10px] text-gray-500 font-bold uppercase tracking-wider mb-1">${label}</div>
                        <div class="text-base font-medium leading-tight">${order.text}</div>
                    </div>
                    <button onclick="updateStatus(${order.id})" 
                            class="${btnClass} text-white text-sm font-bold px-4 py-3 rounded-lg shadow active:scale-95 transition">
                        ${btnText}
                    </button>
                </div>
                `;
                container.insertAdjacentHTML('beforeend', html);
            });
        }

        // –ó–∞–ø—É—Å–∫ –ø—Ä–∏ —Å—Ç–∞—Ä—Ç–µ
        renderOrders();
    </script>
</body>
</html>